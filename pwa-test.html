<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Test - BTH System</title>
    <style>
        body {
            font-family: 'Noto Sans Thai', Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f8fa;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #16a34a;
            border-bottom: 3px solid #16a34a;
            padding-bottom: 10px;
        }
        .test-item {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #16a34a;
            background: #f9fafb;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin-left: 10px;
        }
        .status.pass {
            background: #dcfce7;
            color: #166534;
        }
        .status.fail {
            background: #fee2e2;
            color: #991b1b;
        }
        .status.pending {
            background: #fef3c7;
            color: #92400e;
        }
        button {
            background: #16a34a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #15803d;
        }
        #install-button {
            display: none;
        }
        pre {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ PWA Feature Test - BTH Farmer Tracking</h1>
        
        <div class="test-item">
            <strong>1. Service Worker Support</strong>
            <span id="sw-support" class="status pending">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
            <p id="sw-info"></p>
        </div>

        <div class="test-item">
            <strong>2. Service Worker Registration</strong>
            <span id="sw-registration" class="status pending">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
            <p id="sw-reg-info"></p>
        </div>

        <div class="test-item">
            <strong>3. Manifest File</strong>
            <span id="manifest-check" class="status pending">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
            <p id="manifest-info"></p>
        </div>

        <div class="test-item">
            <strong>4. App Install Status</strong>
            <span id="install-status" class="status pending">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
            <p id="install-info"></p>
            <button id="install-button">üì≤ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</button>
        </div>

        <div class="test-item">
            <strong>5. Cache Storage</strong>
            <span id="cache-status" class="status pending">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>
            <p id="cache-info"></p>
        </div>

        <h2>üìã Test Actions</h2>
        <div class="test-item">
            <button onclick="testOffline()">üîå ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</button>
            <button onclick="clearCache()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä</button>
            <button onclick="unregisterSW()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Service Worker</button>
            <button onclick="location.reload()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤</button>
        </div>

        <h2>üìä Detailed Information</h2>
        <div class="test-item">
            <button onclick="showDetails()">üìñ ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
            <pre id="details" style="display:none;"></pre>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #fef3c7; border-radius: 5px;">
            <strong>‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
            <ul>
                <li>PWA ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏ô HTTPS ‡∏´‡∏£‡∏∑‡∏≠ localhost</li>
                <li>‡∏ö‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</li>
                <li>‡∏Ñ‡∏ß‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</li>
            </ul>
        </div>
    </div>

    <script>
        let deferredPrompt;

        // Test 1: Service Worker Support
        if ('serviceWorker' in navigator) {
            document.getElementById('sw-support').className = 'status pass';
            document.getElementById('sw-support').textContent = '‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
            document.getElementById('sw-info').textContent = '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Service Workers';
        } else {
            document.getElementById('sw-support').className = 'status fail';
            document.getElementById('sw-support').textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
            document.getElementById('sw-info').textContent = '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Service Workers';
        }

        // Test 2: Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistration().then(registration => {
                if (registration) {
                    document.getElementById('sw-registration').className = 'status pass';
                    document.getElementById('sw-registration').textContent = '‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                    document.getElementById('sw-reg-info').innerHTML = `
                        <strong>Scope:</strong> ${registration.scope}<br>
                        <strong>State:</strong> ${registration.active ? registration.active.state : 'N/A'}
                    `;
                } else {
                    document.getElementById('sw-registration').className = 'status fail';
                    document.getElementById('sw-registration').textContent = '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô';
                    document.getElementById('sw-reg-info').textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (index.html) ‡∏Å‡πà‡∏≠‡∏ô';
                }
            });
        }

        // Test 3: Manifest Check
        const manifestUrl = new URL('manifest.json', window.location.origin).href;
        fetch(manifestUrl)
            .then(response => {
                if (response.ok) {
                    document.getElementById('manifest-check').className = 'status pass';
                    document.getElementById('manifest-check').textContent = '‚úÖ ‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå';
                    return response.json();
                } else {
                    throw new Error('Manifest not found');
                }
            })
            .then(manifest => {
                document.getElementById('manifest-info').innerHTML = `
                    <strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${manifest.name}<br>
                    <strong>Short Name:</strong> ${manifest.short_name}<br>
                    <strong>Icons:</strong> ${manifest.icons.length} ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
                `;
            })
            .catch(() => {
                document.getElementById('manifest-check').className = 'status fail';
                document.getElementById('manifest-check').textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå';
                document.getElementById('manifest-info').textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå manifest.json';
            });

        // Test 4: Install Status
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-button').style.display = 'inline-block';
            document.getElementById('install-status').className = 'status pass';
            document.getElementById('install-status').textContent = '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á';
            document.getElementById('install-info').textContent = '‡πÅ‡∏≠‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á';
        });

        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('install-status').className = 'status pass';
            document.getElementById('install-status').textContent = '‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß';
            document.getElementById('install-info').textContent = '‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß';
        }

        document.getElementById('install-button').addEventListener('click', async () => {
            if (!deferredPrompt) {
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ');
                return;
            }
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                document.getElementById('install-info').textContent = '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á';
            } else {
                document.getElementById('install-info').textContent = '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á';
            }
            deferredPrompt = null;
        });

        // Test 5: Cache Storage
        if ('caches' in window) {
            caches.keys().then(names => {
                document.getElementById('cache-status').className = 'status pass';
                document.getElementById('cache-status').textContent = '‚úÖ ‡∏û‡∏ö‡πÅ‡∏Ñ‡∏ä';
                document.getElementById('cache-info').textContent = `‡∏û‡∏ö‡πÅ‡∏Ñ‡∏ä ${names.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${names.join(', ') || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}`;
            });
        } else {
            document.getElementById('cache-status').className = 'status fail';
            document.getElementById('cache-status').textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö';
        }

        // Action functions
        function testOffline() {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î DevTools > Network > ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Offline" ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö');
        }

        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    Promise.all(names.map(name => caches.delete(name)))
                        .then(() => {
                            alert('‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                            location.reload();
                        });
                });
            }
        }

        function unregisterSW() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    Promise.all(registrations.map(reg => reg.unregister()))
                        .then(() => {
                            alert('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Service Worker ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                            location.reload();
                        });
                });
            }
        }

        function showDetails() {
            const details = document.getElementById('details');
            if (details.style.display === 'none') {
                const info = {
                    userAgent: navigator.userAgent,
                    serviceWorker: 'serviceWorker' in navigator,
                    cacheStorage: 'caches' in window,
                    displayMode: window.matchMedia('(display-mode: standalone)').matches ? 'standalone' : 'browser',
                    online: navigator.onLine,
                    cookieEnabled: navigator.cookieEnabled,
                    language: navigator.language,
                    platform: navigator.platform,
                    screenSize: `${screen.width}x${screen.height}`,
                    viewportSize: `${window.innerWidth}x${window.innerHeight}`
                };
                details.textContent = JSON.stringify(info, null, 2);
                details.style.display = 'block';
            } else {
                details.style.display = 'none';
            }
        }
    </script>
</body>
</html>
